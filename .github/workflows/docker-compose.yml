services:
  # Test Bridge mode
  bridge:
    build: .
    container_name: torware-bridge
    restart: unless-stopped
    ports:
      - "9001:9001"
      - "9002:9002"
    environment:
      - MODE=bridge
      - NICKNAME=TestBridge
      - CONTACT=test@example.com
      - BANDWIDTH=5
      - STATS_INTERVAL=60
    volumes:
      - bridge-data:/data
    deploy:
      resources:
        limits:
          cpus: '0.7'
          memory: 128M

  # Test Snowflake mode
  snowflake:
    build: .
    container_name: torware-snowflake
    restart: unless-stopped
    environment:
      - MODE=snowflake
      - SNOWFLAKE_CAPACITY=10
      - STATS_INTERVAL=60
    volumes:
      - snowflake-data:/data
    deploy:
      resources:
        limits:
          cpus: '0.3'
          memory: 64M

  # Test Bridge + Snowflake combined
  full:
    build: .
    container_name: torware-full
    restart: unless-stopped
    ports:
      - "9011:9001"
      - "9012:9002"
    environment:
      - MODE=bridge+snowflake
      - NICKNAME=TestFull
      - BANDWIDTH=5
      - SNOWFLAKE_CAPACITY=5
      - STATS_INTERVAL=60
    volumes:
      - full-data:/data
    deploy:
      resources:
        limits:
          cpus: '0.7'
          memory: 128M

volumes:
  bridge-data:
  snowflake-data:
  full-data:
